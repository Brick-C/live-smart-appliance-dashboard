<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Smart Appliance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
      }
      .card {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -2px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
      <header class="text-center mb-10 p-4 bg-white rounded-xl card">
        <h1 class="text-4xl font-extrabold text-blue-800">
          Live Appliance Energy Monitor
        </h1>
      </header>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Real-Time Data Card -->
        <div
          class="lg:col-span-1 p-6 bg-white rounded-xl card h-full flex flex-col justify-between"
        >
          <div>
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
              Appliance Status
            </h2>
            <div class="space-y-4">
              <div
                class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
              >
                <span class="font-medium text-gray-700">Device:</span>
                <select
                  id="device-selector"
                  class="form-select rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"
                  onchange="changeDevice(this.value)"
                >
                  <option value="">Loading devices...</option>
                </select>
              </div>
              <div
                class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
              >
                <span class="font-medium text-gray-700">Device Control:</span>
                <button
                  id="toggle-button"
                  class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
                  onclick="toggleDevice()"
                >
                  Turn OFF
                </button>
              </div>
              <div
                class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
              >
                <span class="font-medium text-gray-700"
                  >Current Power Draw:</span
                >
                <span
                  class="text-2xl font-extrabold text-green-600"
                  id="current-watts"
                  >0 W</span
                >
              </div>
              <div
                class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
              >
                <span class="font-medium text-gray-700">Total Energy:</span>
                <span
                  class="text-2xl font-extrabold text-purple-600"
                  id="total-kwh"
                  >0.00 kWh</span
                >
              </div>
              <div
                class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
              >
                <span class="font-medium text-gray-700">Electricity Rate:</span>
                <div class="flex items-center space-x-2">
                  <span class="text-gray-600">$</span>
                  <input
                    type="number"
                    id="electricity-rate"
                    class="w-20 px-2 py-1 text-right border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    step="0.01"
                    min="0"
                    placeholder="0.15"
                    onchange="updateElectricityRate(this.value)"
                  />
                  <span class="text-gray-600">/kWh</span>
                </div>
              </div>
              <div
                class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
              >
                <span class="font-medium text-gray-700">Hourly Cost:</span>
                <span class="text-xl font-bold text-orange-600" id="hourly-cost"
                  >$0.00/hr</span
                >
              </div>
              <div
                class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
              >
                <span class="font-medium text-gray-700">Projected Daily:</span>
                <span
                  class="text-2xl font-extrabold text-red-600"
                  id="daily-cost"
                  >$0.00</span
                >
              </div>
            </div>
          </div>

          <div class="mt-6 text-sm text-gray-500 text-center">
            <p>
              API Status:
              <span id="api-status" class="font-semibold text-green-500"
                >Ready</span
              >
            </p>
            <p>Last Update: <span id="last-update">--</span></p>
          </div>
        </div>

        <!-- Live Power Chart Card -->
        <div class="lg:col-span-2 p-6 bg-white rounded-xl card">
          <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
            Live Power Draw (Watts)
          </h2>
          <canvas id="powerChart"></canvas>
        </div>
      </div>

      <!-- Energy Usage History Card -->
      <div class="mt-6 p-6 bg-white rounded-xl card">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
          Energy Usage Trend (kW/h per Update)
        </h2>
        <canvas id="energyChart"></canvas>
      </div>

      <!-- Analytics Section -->
      <div class="mt-6 p-6 bg-white rounded-xl card">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
          Energy Analytics
        </h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <!-- Efficiency Score -->
          <div class="p-4 bg-gray-50 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">
              Efficiency Score
            </h3>
            <div class="flex items-center justify-between">
              <div class="text-3xl font-bold" id="efficiency-score">--</div>
              <div class="text-sm text-gray-600" id="efficiency-label">
                Calculating...
              </div>
            </div>
          </div>

          <!-- Usage Insights -->
          <div class="p-4 bg-gray-50 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">
              Cost Insights
            </h3>
            <div id="cost-insights" class="text-sm text-gray-600">
              <div class="flex justify-between mb-1">
                <span>Today vs Yesterday:</span>
                <span id="cost-comparison">--</span>
              </div>
              <div class="flex justify-between">
                <span>Projected Monthly:</span>
                <span id="projected-cost">--</span>
              </div>
            </div>
          </div>

          <!-- Recommendations -->
          <div class="p-4 bg-gray-50 rounded-lg">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Smart Tips</h3>
            <ul id="energy-tips" class="text-sm text-gray-600 space-y-1">
              <li>Loading recommendations...</li>
            </ul>
            <div id="tip-count" class="text-xs text-gray-500 mt-2">
              0 Active Tips
            </div>
            <div
              id="usage-explanation"
              class="text-sm text-gray-600 mt-2"
            ></div>
            <span id="rate-per-kwh" class="hidden">0</span>
          </div>
        </div>

        <!-- Usage Anomalies -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
          <h3 class="text-lg font-semibold text-gray-700 mb-3">
            Usage Analysis
          </h3>
          <div
            id="usage-anomalies"
            class="grid grid-cols-1 lg:grid-cols-2 gap-4"
          >
            <div class="space-y-2">
              <div class="text-sm font-medium">Peak Usage Times:</div>
              <div id="peak-times" class="text-sm text-gray-600">
                Analyzing...
              </div>
            </div>
            <div class="space-y-2">
              <div class="text-sm font-medium">Standby Power Detection:</div>
              <div id="standby-detection" class="text-sm text-gray-600">
                Monitoring...
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Historical Data Section -->
      <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Daily Summary Card -->
        <div class="p-6 bg-white rounded-xl card">
          <div class="flex justify-between items-center mb-4 border-b pb-2">
            <h2 class="text-2xl font-bold text-gray-800">Daily Summary</h2>
            <select
              id="history-timeframe"
              class="rounded-md border-gray-300 text-sm"
            >
              <option value="today">Today</option>
              <option value="yesterday">Yesterday</option>
              <option value="last7">Last 7 Days</option>
              <option value="last30">Last 30 Days</option>
            </select>
          </div>
          <div class="space-y-4">
            <div
              class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
            >
              <span class="font-medium text-gray-700">Peak Usage:</span>
              <span class="font-bold text-orange-600" id="peak-usage">--</span>
            </div>
            <div
              class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
            >
              <span class="font-medium text-gray-700">Average Usage:</span>
              <span class="font-bold text-blue-600" id="avg-usage">--</span>
            </div>
            <div
              class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
            >
              <span class="font-medium text-gray-700">Total Energy:</span>
              <span class="font-bold text-purple-600" id="total-usage">--</span>
            </div>
            <div
              class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
            >
              <span class="font-medium text-gray-700">Total Cost:</span>
              <span class="font-bold text-red-600" id="total-cost">--</span>
            </div>
            <div
              class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
            >
              <span class="font-medium text-gray-700">Today's Cost:</span>
              <span class="font-bold text-red-600" id="today-cost">--</span>
            </div>
            <div
              class="flex justify-between items-center p-3 bg-gray-50 rounded-lg"
            >
              <span class="font-medium text-gray-700">This Week's Cost:</span>
              <span class="font-bold text-red-600" id="week-cost">--</span>
            </div>
          </div>
          <!-- Export Options -->
          <div class="mt-4 flex justify-end space-x-2">
            <button
              onclick="exportData('csv')"
              class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700"
            >
              Export CSV
            </button>
            <button
              onclick="exportData('json')"
              class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
            >
              Export JSON
            </button>
          </div>
        </div>

        <!-- Usage Patterns Card -->
        <div class="p-6 bg-white rounded-xl card">
          <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">
            Usage Patterns
          </h2>
          <canvas id="patternsChart"></canvas>
          <div class="mt-4 text-sm text-gray-600">
            <h3 class="font-semibold mb-2">Peak Usage Hours:</h3>
            <ul id="peak-hours-list" class="list-disc pl-5 space-y-1">
              <li>Loading usage patterns...</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script src="./historical-data.js"></script>
    <script src="./cost-calculator.js"></script>
    <script src="./main.js"></script>
  </body>
</html>
